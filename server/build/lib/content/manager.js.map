{"version":3,"sources":["../../../src/lib/content/manager.js"],"names":["findAll","queryOptions","options","count","removed","total","list","limit","find","sort","createdAt","skip","offset","meta","length","getById","id","findById","result","hitById","analyse","hits","save","getNearByCreatedAt","findOne","$lt","_id","prev","$gt","next"],"mappings":";;;;;;;;;;;;;;;;;;AAAA;;;;AACA;;;;AAEA,IAAMA;AAAA,sFAAU;AAAA,QAAOC,YAAP,uEAAsB,EAAtB;AAAA,QAA0BC,OAA1B,uEAAoC,EAApC;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,mBACM,gBAAMC,KAAN,CAAY,EAAEC,SAAS,KAAX,EAAZ,CADN;;AAAA;AACRC,iBADQ;;AAEdH,sBAAU,sBAAcA,OAAd,EAAuB,EAAEE,SAAS,KAAX,EAAvB,CAAV;AACIE,gBAHU,GAGH,EAHG;;AAAA,kBAIVL,aAAaM,KAAb,KAAuB,CAAC,CAJd;AAAA;AAAA;AAAA;;AAAA;AAAA,mBAKC,gBAAMC,IAAN,CAAWN,OAAX,EAAoBO,IAApB,CAAyB,EAAEC,WAAW,CAAC,CAAd,EAAzB,CALD;;AAAA;AAKZJ,gBALY;AAAA;AAAA;;AAAA;AAAA;AAAA,mBAOC,gBAAME,IAAN,CAAWN,OAAX,EAAoBK,KAApB,CAA0BN,aAAaM,KAAvC,EAA8CI,IAA9C,CAAmDV,aAAaW,MAAhE,EAAwEH,IAAxE,CAA6E,EAAEC,WAAW,CAAC,CAAd,EAA7E,CAPD;;AAAA;AAOZJ,gBAPY;;AAAA;AAAA,6CASP;AACLO,oBAAM,yBAAQR,KAAR,EAAeC,KAAKQ,MAApB,EAA4Bb,YAA5B,CADD;AAELK;AAFK,aATO;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,GAAV;;AAAA;AAAA;AAAA;AAAA,GAAN;;AAeA,IAAMS;AAAA,uFAAU,kBAAOC,EAAP;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,mBACO,gBAAMC,QAAN,CAAeD,EAAf,CADP;;AAAA;AACRE,kBADQ;AAAA,8CAEPA,MAFO;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,GAAV;;AAAA;AAAA;AAAA;AAAA,GAAN;;AAKA,IAAMC;AAAA,uFAAU,kBAAOH,EAAP;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,mBACQ,gBAAMC,QAAN,CAAeD,EAAf,CADR;;AAAA;AACRI,mBADQ;;AAAA,gBAEPA,OAFO;AAAA;AAAA;AAAA;;AAAA,8CAGD,IAHC;;AAAA;AAKZ,cAAEA,QAAQC,IAAV;AALY;AAAA,mBAMSD,QAAQE,IAAR,EANT;;AAAA;AAMNJ,kBANM;AAAA,8CAOLA,MAPK;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,GAAV;;AAAA;AAAA;AAAA;AAAA,GAAN;;AAUA,IAAMK;AAAA,uFAAqB,kBAAOb,SAAP;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,mBACN,gBAAMc,OAAN,CAAc,EAAEpB,SAAS,KAAX,EAAkBM,WAAW,EAAEe,KAAKf,SAAP,EAA7B,EAAd,EAAiED,IAAjE,CAAsE,EAAEiB,KAAK,CAAC,CAAR,EAAtE,CADM;;AAAA;AACnBC,gBADmB;AAAA;AAAA,mBAEN,gBAAMH,OAAN,CAAc,EAAEpB,SAAS,KAAX,EAAkBM,WAAW,EAAEkB,KAAKlB,SAAP,EAA7B,EAAd,EAAiED,IAAjE,CAAsE,EAAEiB,KAAK,CAAP,EAAtE,CAFM;;AAAA;AAEnBG,gBAFmB;AAAA,8CAGlB;AACLF,wBADK;AAELE;AAFK,aAHkB;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,GAArB;;AAAA;AAAA;AAAA;AAAA,GAAN;;kBASe;AACb7B,kBADa;AAEbe,kBAFa;AAGbI,kBAHa;AAIbI;AAJa,C","file":"manager.js","sourcesContent":["import Model from './model'\nimport { getMeta } from '../util/pagination'\n\nconst findAll = async (queryOptions = {}, options = {}) => {\n  const total = await Model.count({ removed: false })\n  options = Object.assign(options, { removed: false })\n  let list = []\n  if (queryOptions.limit === -1) {\n    list = await Model.find(options).sort({ createdAt: -1 })\n  } else {\n    list = await Model.find(options).limit(queryOptions.limit).skip(queryOptions.offset).sort({ createdAt: -1 })\n  }\n  return {\n    meta: getMeta(total, list.length, queryOptions),\n    list\n  }\n}\n\nconst getById = async (id) => {\n  const result = await Model.findById(id)\n  return result\n}\n\nconst hitById = async (id) => {\n    let analyse = await Model.findById(id)\n    if (!analyse) {\n        return null\n    }\n    ++analyse.hits\n    const result = await analyse.save()\n    return result\n}\n\nconst getNearByCreatedAt = async (createdAt) => {\n  const prev = await Model.findOne({ removed: false, createdAt: { $lt: createdAt } }).sort({ _id: -1 })\n  const next = await Model.findOne({ removed: false, createdAt: { $gt: createdAt } }).sort({ _id: 1 })\n  return {\n    prev,\n    next\n  }\n}\n\nexport default {\n  findAll,\n  getById,\n  hitById,\n  getNearByCreatedAt\n}\n"]}