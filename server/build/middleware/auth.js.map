{"version":3,"sources":["../../src/middleware/auth.js"],"names":["auth","app","params","secretOrKey","jwtFromRequest","fromAuthHeaderWithScheme","strategy","payload","next","getUserById","id","then","user","_id","email","catch","error","use","initialize","authenticate","session"],"mappings":";;;;;;AAAA;;;;AACA;;AAEA;;;;AACA;;;;AAEA,IAAMA,OAAO,SAAPA,IAAO,CAACC,GAAD,EAAS;AACpB,MAAMC,SAAS;AACbC,mCADa;AAEbC,oBAAgB,wBAAWC,wBAAX,CAAoC,QAApC;AAFH,GAAf;AAIA,MAAMC,WAAW,0BAAaJ,MAAb,EAAqB,UAACK,OAAD,EAAUC,IAAV,EAAmB;AACvD,sBAAYC,WAAZ,CAAwBF,QAAQG,EAAhC,EACGC,IADH,CACQ,gBAAQ;AACZ,UAAIC,IAAJ,EAAU;AACR,eAAOJ,KAAK,IAAL,EAAW;AAChBE,cAAIE,KAAKC,GADO;AAEhBC,iBAAOF,KAAKE;AAFI,SAAX,CAAP;AAID;AACD,aAAON,KAAK,IAAL,EAAW,IAAX,CAAP;AACD,KATH,EAUGO,KAVH,CAUS;AAAA,aAASP,KAAKQ,KAAL,EAAY,IAAZ,CAAT;AAAA,KAVT;AAWD,GAZgB,CAAjB;AAaA,qBAASC,GAAT,CAAaX,QAAb;AACA,SAAO;AACLY,gBAAY,sBAAM;AAChB,aAAO,mBAASA,UAAT,EAAP;AACD,KAHI;AAILC,kBAAc,wBAAM;AAClB,aAAO,mBAASA,YAAT,CAAsB,KAAtB,EAA6B,EAAEC,SAAS,KAAX,EAA7B,CAAP;AACD;AANI,GAAP;AAQD,CA3BD;;kBA6BepB,I","file":"auth.js","sourcesContent":["import passport from 'passport'\nimport { Strategy, ExtractJwt } from 'passport-jwt'\n\nimport userManager from '../lib/user/manager'\nimport { JWT_SECRET } from '../config'\n\nconst auth = (app) => {\n  const params = {\n    secretOrKey: JWT_SECRET,\n    jwtFromRequest: ExtractJwt.fromAuthHeaderWithScheme('Bearer')\n  }\n  const strategy = new Strategy(params, (payload, next) => {\n    userManager.getUserById(payload.id)\n      .then(user => {\n        if (user) {\n          return next(null, {\n            id: user._id,\n            email: user.email\n          })\n        }\n        return next(null, null)\n      })\n      .catch(error => next(error, null))\n  })\n  passport.use(strategy)\n  return {\n    initialize: () => {\n      return passport.initialize()\n    },\n    authenticate: () => {\n      return passport.authenticate('jwt', { session: false })\n    }\n  }\n}\n\nexport default auth\n"]}